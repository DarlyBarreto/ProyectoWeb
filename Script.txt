select am.name as Factura,
rp.name as Cliente,
am.invoice_date as "Fecha de factura",
pp.default_code as Producto,
aml.quantity as cantidad,
aml.name as Descripcion,
aa.code as Cuenta,
aa.name as cuenta,
aml.price_unit as "Precio unitario",
aml.price_subtotal as subtotal,
am.amount_untaxed as Importe,
am.amount_tax as "Iva 12%",
am.amount_total as total,
am.amount_residual as "importe adeudado",
aml2.name as Impuesto
from account_move am
inner join account_move_line aml on aml.move_id = am.id
inner join res_partner rp on am.partner_id = rp.id
inner join product_product pp on pp.id = aml.product_id
inner join account_account aa on aml.account_id = aa.id
inner join account_move_line aml2 on aml2.move_id = am.id
where am.name = 'Fact 001-001-000000002'
and aml2.name = 'IVA 12% (411, Bienes)' ;
-===============================================================
select am.name as Factura,
rp.name as Cliente,
am.invoice_date as "Fecha de factura",
pp.default_code as Producto,
aml.quantity as cantidad,
aml.name as Descripcion,
aa.code as Cuenta,
aa.name as cuenta,
aml.price_unit as "Precio unitario",
aml.price_subtotal as subtotal,
am.amount_untaxed as Importe,
am.amount_tax as "Iva 12%",
am.amount_total as total,
am.amount_residual as "importe adeudado"
from account_move am
inner join account_move_line aml on aml.move_id = am.id
inner join res_partner rp on am.partner_id = rp.id
inner join product_product pp on pp.id = aml.product_id
inner join account_account aa on aml.account_id = aa.id
where am.name = 'Fact 001-001-000000001';
====================================================================
select am.name as Factura,
rp.name as Cliente,
am.invoice_date as "Fecha de factura",
pp.default_code as Producto,
aml.quantity as cantidad,
aml.name as Descripcion,
aa.code as Cuenta,
aa.name as cuenta,
aml.price_subtotal as subtotal,
sum(aml.price_subtotal) as base 
from account_move am
inner join account_move_line aml on aml.move_id = am.id
inner join res_partner rp on am.partner_id = rp.id
inner join product_product pp on pp.id = aml.product_id
inner join account_account aa on aml.account_id = aa.id
where am.name = 'Fact 001-001-000000001'
group by am.name,
rp.name,
am.invoice_date ,
pp.default_code,
aml.quantity,
aml.name,
aa.code,
aa.name ,
aml.price_subtotal;
==================================================================================
SELECT 
    rp.name AS nombre_cliente,
    rp.email AS email_cliente,
    rp.phone AS telefono_cliente,
    pt.name ->> 'en_US' AS nombre_producto,
    SUM(sol.product_uom_qty) AS cantidad_comprada
FROM 
    sale_order so
JOIN 
    res_partner rp ON so.partner_id = rp.id
JOIN 
    sale_order_line sol ON sol.order_id = so.id
JOIN 
    product_product pp ON sol.product_id = pp.id
JOIN 
    product_template pt ON pp.product_tmpl_id = pt.id
WHERE 
    so.state IN ('sale', 'done')  -- Filtrar solo Ã³rdenes confirmadas o completadas
GROUP BY 
    rp.name, rp.email, rp.phone, pt.name
ORDER BY 
    rp.name;